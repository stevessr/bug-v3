<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>视频转 GIF - Video to GIF Converter</title>
    <link rel="stylesheet" href="/assets/css/style.css" />
  </head>
  <body>
    <div class="container">
      <h1>🎬 视频转 GIF</h1>
      <p class="subtitle">上传 MP4 视频或提供 URL，快速转换为 GIF 动图</p>
      <p style="margin: 8px 0 16px">
        <a class="btn" href="/webcodecs-check.html" target="_blank" rel="noopener">
          🧪 打开 WebCodecs 检测页
        </a>
      </p>

      <!-- 输入区域 -->
      <div class="section">
        <div class="section-title">1. 选择视频</div>
        <div class="input-group">
          <label>上传 MP4 文件</label>
          <input type="file" id="fileInput" accept="video/mp4" />
          <p class="hint">或</p>
        </div>
        <div class="input-group">
          <label>视频 URL</label>
          <input type="url" id="urlInput" placeholder="https://example.com/video.mp4" />
          <button
            class="btn-preset"
            id="analyzeBtn"
            onclick="analyzeVideoFromUrl()"
            style="margin-top: 8px"
            disabled
          >
            🔍 分析视频
          </button>
        </div>
      </div>

      <!-- 参数设置 -->
      <div class="section">
        <div class="section-title">2. 转换参数（可选）</div>

        <!-- 预设按钮 -->
        <div class="preset-buttons">
          <button class="btn-preset" id="originalBtn" onclick="useOriginalParams()" disabled>
            📹 使用原视频参数
          </button>
          <button class="btn-preset" onclick="applyPreset('high')">🎯 高质量 (15fps/720p)</button>
          <button class="btn-preset" onclick="applyPreset('medium')">⚡ 平衡 (10fps/480p)</button>
          <button class="btn-preset" onclick="applyPreset('low')">💾 低体积 (8fps/360p)</button>
          <button class="btn-preset" onclick="applyPreset('emoji')">😄 表情包 (12fps/320p)</button>
          <button class="btn-preset" onclick="applyPreset('short')">⏱️ 3 秒片段</button>
        </div>

        <div class="params-grid">
          <div class="input-group">
            <label>帧率 (FPS)</label>
            <input type="number" id="fps" value="10" min="1" max="30" />
          </div>
          <div class="input-group">
            <label>输出格式</label>
            <select id="format">
              <option value="gif" selected>GIF（动图）</option>
              <option value="webp">WebP（动图）</option>
              <option value="apng">APNG（动图）</option>
              <option value="avif">AVIF（实验/可能仅静态）</option>
            </select>
            <p class="hint">不同格式体积和兼容性不同，GIF 通用，WebP 体积更小。</p>
          </div>
          <div class="input-group" id="globalQualityGroup">
            <label for="quality">
              质量：
              <span id="qualityValue">1%</span>
            </label>
            <input type="range" id="quality" min="0" max="100" step="1" value="1" />
            <p class="hint">
              适用于所有可调质量的格式：GIF/WEBP/APNG/AVIF（或其降级）。数值越大质量越高、体积越大。
            </p>
          </div>
          <div class="input-group" id="gifProfileGroup">
            <label>GIF 模式</label>
            <select id="gifProfile">
              <option value="hq" selected>高质量（两步法，抖动优化）</option>
              <option value="classic">经典（Floyd-Steinberg 抖动）</option>
              <option value="small">体积优先（64 色 + 强抖动）</option>
            </select>
            <p class="hint">仅在选择 GIF 格式时生效。体积优先适合表情包/大幅压缩。</p>
          </div>
          <div class="input-group" id="avifWebCodecsGroup" style="display: none">
            <label>
              <input type="checkbox" id="useWebCodecs" />
              使用 WebCodecs 编码真正的 AVIF
            </label>
            <p class="hint">
              ⚠️ 实验性功能！需要浏览器支持 WebCodecs ImageEncoder。不勾选则降级为 WebP。
            </p>
          </div>
          <div class="input-group">
            <label>宽度 (px)</label>
            <input type="number" id="width" value="480" min="64" max="1280" step="16" />
          </div>
          <div class="input-group">
            <label>高度 (px)</label>
            <input type="number" id="height" value="-1" />
            <p class="hint">-1 为自动</p>
          </div>
          <div class="input-group">
            <label>起始时间 (秒)</label>
            <input type="number" id="startTime" value="" placeholder="0" />
          </div>
          <div class="input-group">
            <label>持续时长 (秒)</label>
            <input type="number" id="duration" value="" placeholder="全部" />
          </div>
        </div>
      </div>

      <!-- 操作按钮 -->
      <div class="btn-group">
        <button class="btn" onclick="convert()" id="convertBtn">开始转换</button>
        <button class="btn btn-secondary" onclick="reset()">重置</button>
      </div>

      <!-- 状态信息 -->
      <div id="status"></div>

      <!-- 结果展示 -->
      <div id="result"></div>

      <!-- 日志 -->
      <div class="log" id="log"></div>
    </div>

    <script type="module" src="/assets/js/app.js"></script>
  </body>
</html>
