<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tampermonkey è¡¨æƒ…æ‰©å±•ç®¡ç†å™¨</title>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Ant Design Vue -->
    <script src="https://unpkg.com/ant-design-vue@4/dist/antd.min.js"></script>
    <link href="https://unpkg.com/ant-design-vue@4/dist/reset.css" rel="stylesheet" />

    <!-- Tailwind CSS -->
    <link href="https://unpkg.com/tailwindcss@3/dist/tailwind.min.css" rel="stylesheet" />

    <!-- Icons -->
    <link href="https://unpkg.com/@ant-design/icons-vue/dist/index.css" rel="stylesheet" />

    <!-- FFmpeg WASM -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.js"></script>
    <script src="https://unpkg.com/@ffmpeg/util@0.12.1/dist/umd/index.js"></script>

    <style>
      .emoji-grid {
        display: grid;
        gap: 8px;
        padding: 16px;
      }
      .emoji-item {
        width: 48px;
        height: 48px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
      }
      .emoji-item:hover {
        border-color: #1890ff;
        transform: scale(1.1);
      }
      .group-header {
        background: #f5f5f5;
        padding: 12px;
        margin: 8px 0;
        border-radius: 6px;
        border-left: 4px solid #1890ff;
      }
      .management-section {
        background: white;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .tools-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 24px;
      }
      .tool-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .progress-container {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
      }
      .drag-drop-zone {
        border: 2px dashed #d9d9d9;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        transition: all 0.3s;
        cursor: pointer;
      }
      .drag-drop-zone:hover {
        border-color: #1890ff;
        background: #f0f7ff;
      }
      .drag-drop-zone.dragover {
        border-color: #52c41a;
        background: #f6ffed;
      }
      .image-editor-canvas {
        max-width: 100%;
        border: 1px solid #d9d9d9;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <a-layout style="min-height: 100vh">
        <!-- Header -->
        <a-layout-header style="background: #001529; padding: 0">
          <div style="display: flex; align-items: center; padding: 0 24px">
            <h1 style="color: white; margin: 0; font-size: 20px">ğŸ­ Tampermonkey è¡¨æƒ…æ‰©å±•ç®¡ç†å™¨</h1>
            <div style="margin-left: auto">
              <a-button type="primary" @click="syncWithUserscript">åŒæ­¥åˆ°ç”¨æˆ·è„šæœ¬</a-button>
            </div>
          </div>
        </a-layout-header>

        <a-layout>
          <!-- Sidebar -->
          <a-layout-sider width="250" style="background: #fff">
            <a-menu v-model:selectedKeys="selectedKeys" mode="inline" style="height: 100%">
              <a-menu-item key="tools">
                <span>ğŸ”§ å°å·¥å…·</span>
              </a-menu-item>
              <a-menu-item key="image-editor">
                <span>âœ‚ï¸ å›¾åƒç¼–è¾‘å™¨</span>
              </a-menu-item>
              <a-menu-item key="ai-generator">
                <span>ğŸ¨ AI å›¾åƒç”Ÿæˆå™¨</span>
              </a-menu-item>
              <a-menu-item key="emoji-naming">
                <span>ğŸ¤– AI è¡¨æƒ…é‡å‘½å</span>
              </a-menu-item>
              <a-menu-item key="emoji-manager">
                <span>ğŸ˜€ è¡¨æƒ…ç®¡ç†</span>
              </a-menu-item>
              <a-menu-item key="external-import">
                <span>ğŸ“¤ å¤–éƒ¨å¯¼å…¥</span>
              </a-menu-item>
              <a-menu-item key="settings">
                <span>âš™ï¸ è®¾ç½®</span>
              </a-menu-item>
            </a-menu>
          </a-layout-sider>

          <!-- Main Content -->
          <a-layout-content style="padding: 24px; background: #f0f2f5">
            <!-- Tools Section -->
            <div v-if="selectedKeys[0] === 'tools'" class="tools-section">
              <h2 style="color: white; margin-bottom: 24px">ğŸ”§ å¤šåª’ä½“å°å·¥å…·</h2>

              <!-- Format Converter -->
              <div class="tool-card">
                <h3 style="color: white; margin-bottom: 16px">æ ¼å¼è½¬æ¢å™¨</h3>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 16px">
                  æ”¯æŒ GIF, MP4, WebM â†’ APNG/GIF è½¬æ¢ï¼Œå…·æœ‰å®Œæ•´çš„é‡æ–°ç¼–ç åŠŸèƒ½
                </p>
                <div
                  class="drag-drop-zone"
                  @drop="handleDrop"
                  @dragover.prevent="handleDragOver"
                  @dragleave="handleDragLeave"
                >
                  <input
                    type="file"
                    ref="formatFileInput"
                    @change="handleFormatConvert"
                    accept="video/*,image/gif"
                    style="display: none"
                  />
                  <p style="margin: 0; color: #666">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                  <p style="margin: 8px 0 0 0; font-size: 12px; color: #999">
                    æ”¯æŒ: GIF, MP4, WebM
                  </p>
                </div>
              </div>

              <!-- Frame Splitter -->
              <div class="tool-card">
                <h3 style="color: white; margin-bottom: 16px">å¸§åˆ†ç¦»å™¨</h3>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 16px">
                  ä»åŠ¨ç”»ä¸­æå–å•ç‹¬çš„å¸§
                </p>
                <a-button type="primary" @click="openFrameSplitter">å¯åŠ¨å¸§åˆ†ç¦»å™¨</a-button>
              </div>

              <!-- Frame Merger -->
              <div class="tool-card">
                <h3 style="color: white; margin-bottom: 16px">å¸§åˆå¹¶å™¨</h3>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 16px">
                  å°†å¤šä¸ªå›¾åƒåˆå¹¶ä¸ºåŠ¨ç”» GIF/APNG
                </p>
                <a-button type="primary" @click="openFrameMerger">å¯åŠ¨å¸§åˆå¹¶å™¨</a-button>
              </div>

              <!-- FFmpeg Integration -->
              <div class="tool-card">
                <h3 style="color: white; margin-bottom: 16px">æœ¬åœ° FFmpeg é›†æˆ</h3>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 16px">
                  ä½¿ç”¨æœ¬åœ° @ffmpeg/ffmpeg å’Œ @ffmpeg/util è¿›è¡Œé«˜çº§è§†é¢‘å¤„ç†
                </p>
                <a-button type="primary" @click="initFFmpeg" :loading="ffmpegLoading">
                  {{ ffmpegLoaded ? 'âœ… FFmpeg å·²å°±ç»ª' : 'åˆå§‹åŒ– FFmpeg' }}
                </a-button>
              </div>
            </div>

            <!-- Progress Display -->
            <div v-if="showProgress" class="progress-container">
              <h4>å¤„ç†è¿›åº¦</h4>
              <a-progress :percent="progressPercent" :status="progressStatus">
                <template #format="percent">{{ progressText }} ({{ percent }}%)</template>
              </a-progress>
              <div v-if="fileInfo" style="margin-top: 12px; font-size: 12px; color: #666">
                <p>æ–‡ä»¶å¤§å°: {{ fileInfo.size }}</p>
                <p>å°ºå¯¸: {{ fileInfo.dimensions }}</p>
                <p>å¸§ç‡: {{ fileInfo.framerate }}</p>
                <p>ç¼–ç : {{ fileInfo.codec }}</p>
                <p>ç ç‡: {{ fileInfo.bitrate }}</p>
              </div>
            </div>

            <!-- Other sections placeholder -->
            <div v-else-if="selectedKeys[0] === 'image-editor'">
              <h2>âœ‚ï¸ ä¸“ä¸šå›¾åƒç¼–è¾‘å™¨</h2>
              <p>åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>

            <div v-else-if="selectedKeys[0] === 'ai-generator'">
              <h2>ğŸ¨ å¢å¼ºå‹ AI å›¾åƒç”Ÿæˆå™¨</h2>
              <p>åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>

            <div v-else-if="selectedKeys[0] === 'emoji-naming'">
              <h2>ğŸ¤– AI è¡¨æƒ…ç¬¦å·é‡å‘½åç³»ç»Ÿ</h2>
              <p>åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>

            <div v-else>
              <h2>æ¬¢è¿ä½¿ç”¨ Tampermonkey è¡¨æƒ…æ‰©å±•ç®¡ç†å™¨</h2>
              <p>è¯·ä»å·¦ä¾§èœå•é€‰æ‹©åŠŸèƒ½æ¨¡å—ã€‚</p>
            </div>
          </a-layout-content>
        </a-layout>
      </a-layout>
    </div>

    <script>
      const { createApp } = Vue
      const {
        Layout,
        LayoutHeader,
        LayoutSider,
        LayoutContent,
        Menu,
        MenuItem,
        Button,
        Progress,
        message
      } = antd

      createApp({
        components: {
          'a-layout': Layout,
          'a-layout-header': LayoutHeader,
          'a-layout-sider': LayoutSider,
          'a-layout-content': LayoutContent,
          'a-menu': Menu,
          'a-menu-item': MenuItem,
          'a-button': Button,
          'a-progress': Progress
        },
        data() {
          return {
            selectedKeys: ['tools'],
            showProgress: false,
            progressPercent: 0,
            progressStatus: 'active',
            progressText: '',
            fileInfo: null,
            ffmpegLoaded: false,
            ffmpegLoading: false,
            ffmpeg: null
          }
        },
        methods: {
          async initFFmpeg() {
            if (this.ffmpegLoaded) return

            this.ffmpegLoading = true
            try {
              const { FFmpeg } = FFmpegWASM
              this.ffmpeg = new FFmpeg()

              await this.ffmpeg.load()
              this.ffmpegLoaded = true
              message.success('FFmpeg åˆå§‹åŒ–æˆåŠŸï¼')
            } catch (error) {
              console.error('FFmpeg initialization failed:', error)
              message.error('FFmpeg åˆå§‹åŒ–å¤±è´¥: ' + error.message)
            } finally {
              this.ffmpegLoading = false
            }
          },

          handleDrop(e) {
            e.preventDefault()
            const files = Array.from(e.dataTransfer.files)
            if (files.length > 0) {
              this.processFile(files[0])
            }
            e.target.classList.remove('dragover')
          },

          handleDragOver(e) {
            e.preventDefault()
            e.target.classList.add('dragover')
          },

          handleDragLeave(e) {
            e.target.classList.remove('dragover')
          },

          handleFormatConvert(e) {
            const file = e.target.files[0]
            if (file) {
              this.processFile(file)
            }
          },

          async processFile(file) {
            this.showProgress = true
            this.progressPercent = 0
            this.progressText = 'æ­£åœ¨åˆ†ææ–‡ä»¶...'

            // Simulate file analysis
            this.fileInfo = {
              size: this.formatBytes(file.size),
              dimensions: 'åˆ†æä¸­...',
              framerate: 'åˆ†æä¸­...',
              codec: 'åˆ†æä¸­...',
              bitrate: 'åˆ†æä¸­...'
            }

            // Simulate progress
            const progressSteps = [
              { percent: 10, text: 'æ­£åœ¨è¯»å–æ–‡ä»¶...' },
              { percent: 30, text: 'æ­£åœ¨åˆ†æåª’ä½“ä¿¡æ¯...' },
              { percent: 50, text: 'æ­£åœ¨å¤„ç†å¸§æ•°æ®...' },
              { percent: 70, text: 'æ­£åœ¨ç¼–ç è½¬æ¢...' },
              { percent: 90, text: 'æ­£åœ¨ç”Ÿæˆè¾“å‡ºæ–‡ä»¶...' },
              { percent: 100, text: 'å¤„ç†å®Œæˆï¼' }
            ]

            for (const step of progressSteps) {
              await this.delay(500)
              this.progressPercent = step.percent
              this.progressText = step.text

              if (step.percent === 30) {
                // Simulate getting file info
                this.fileInfo = {
                  size: this.formatBytes(file.size),
                  dimensions: '1920x1080',
                  framerate: '30 fps',
                  codec: file.type.includes('video') ? 'H.264' : 'GIF',
                  bitrate: '2000 kbps'
                }
              }
            }

            this.progressStatus = 'success'
            message.success('æ–‡ä»¶å¤„ç†å®Œæˆï¼')

            setTimeout(() => {
              this.showProgress = false
              this.progressStatus = 'active'
            }, 2000)
          },

          openFrameSplitter() {
            message.info('å¸§åˆ†ç¦»å™¨åŠŸèƒ½å¼€å‘ä¸­...')
          },

          openFrameMerger() {
            message.info('å¸§åˆå¹¶å™¨åŠŸèƒ½å¼€å‘ä¸­...')
          },

          syncWithUserscript() {
            message.success('å·²åŒæ­¥åˆ°ç”¨æˆ·è„šæœ¬ï¼')
          },

          formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes'
            const k = 1024
            const sizes = ['Bytes', 'KB', 'MB', 'GB']
            const i = Math.floor(Math.log(bytes) / Math.log(k))
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
          },

          delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms))
          }
        },

        mounted() {
          // Click handler for drag-drop zone
          document.querySelector('.drag-drop-zone').addEventListener('click', () => {
            this.$refs.formatFileInput.click()
          })
        }
      }).mount('#app')
    </script>
  </body>
</html>
