<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¡¨æƒ…ç®¡ç†å™¨ - Emoji Extension Manager</title>
    <script type="module" src="/src/emoji-manager.ts"></script>
    <style>
      .emoji-grid {
        display: grid;
        gap: 8px;
        padding: 16px;
      }
      .emoji-item {
        width: 48px;
        height: 48px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
      }
      .emoji-item:hover {
        border-color: #1890ff;
        transform: scale(1.1);
      }
      .group-header {
        background: #f5f5f5;
        padding: 12px;
        margin: 8px 0;
        border-radius: 6px;
        border-left: 4px solid #1890ff;
      }
      .management-section {
        background: white;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <div id="app">
      <a-layout style="min-height: 100vh">
        <!-- Header -->
        <a-layout-header style="background: #001529; padding: 0">
          <div
            style="
              color: white;
              padding: 0 24px;
              display: flex;
              align-items: center;
              justify-content: space-between;
            "
          >
            <h1 style="color: white; margin: 0; font-size: 18px">ğŸˆâ€â¬› è¡¨æƒ…ç®¡ç†å™¨</h1>
            <div>
              <a-button @click="exportData" style="margin-right: 8px">å¯¼å‡ºæ•°æ®</a-button>
              <a-button @click="showImportModal = true" type="primary">å¯¼å…¥æ•°æ®</a-button>
            </div>
          </div>
        </a-layout-header>

        <a-layout>
          <!-- Sidebar -->
          <a-layout-sider width="200" style="background: #fff">
            <a-menu
              v-model:selectedKeys="selectedKeys"
              mode="inline"
              style="height: 100%; border-right: 0"
            >
              <a-menu-item key="groups" @click="activeTab = 'groups'">
                <span>ğŸ“ åˆ†ç»„ç®¡ç†</span>
              </a-menu-item>
              <a-menu-item key="settings" @click="activeTab = 'settings'">
                <span>âš™ï¸ è®¾ç½®</span>
              </a-menu-item>
              <a-menu-item key="favorites" @click="activeTab = 'favorites'">
                <span>â­ æ”¶è—å¤¹</span>
              </a-menu-item>
              <a-menu-item key="export" @click="activeTab = 'export'">
                <span>ğŸ“¤ å¯¼å‡º/åŒæ­¥</span>
              </a-menu-item>
            </a-menu>
          </a-layout-sider>

          <!-- Content -->
          <a-layout-content style="margin: 24px 16px; padding: 24px; background: #f0f2f5">
            <!-- Groups Management -->
            <div v-if="activeTab === 'groups'">
              <div class="management-section">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  "
                >
                  <h2>è¡¨æƒ…åˆ†ç»„ç®¡ç†</h2>
                  <a-button type="primary" @click="showCreateGroupModal = true">åˆ›å»ºåˆ†ç»„</a-button>
                </div>

                <!-- Groups List -->
                <a-list :data-source="emojiGroups" item-layout="vertical">
                  <template #renderItem="{ item: group }">
                    <a-list-item>
                      <template #actions>
                        <a @click="editGroup(group)">ç¼–è¾‘</a>
                        <a @click="deleteGroup(group.id)">åˆ é™¤</a>
                        <a @click="showAddEmojiModal(group.id)">æ·»åŠ è¡¨æƒ…</a>
                      </template>

                      <div class="group-header">
                        <h3 style="margin: 0; display: flex; align-items: center">
                          <span style="margin-right: 8px; font-size: 18px">{{ group.icon }}</span>
                          {{ group.name }}
                          <a-tag style="margin-left: 8px">
                            {{ group.emojis?.length || 0 }} ä¸ªè¡¨æƒ…
                          </a-tag>
                        </h3>
                      </div>

                      <!-- Emojis Grid -->
                      <div
                        class="emoji-grid"
                        :style="{gridTemplateColumns: `repeat(${settings.gridColumns}, 1fr)`}"
                      >
                        <img
                          v-for="emoji in group.emojis"
                          :key="emoji.packet || emoji.name"
                          :src="emoji.url"
                          :alt="emoji.name"
                          :title="emoji.name"
                          class="emoji-item"
                          @click="editEmoji(emoji, group.id)"
                          @error="handleImageError"
                        />
                      </div>
                    </a-list-item>
                  </template>
                </a-list>
              </div>
            </div>

            <!-- Settings -->
            <div v-if="activeTab === 'settings'" class="management-section">
              <h2>å…¨å±€è®¾ç½®</h2>

              <a-form layout="vertical">
                <a-row :gutter="16">
                  <a-col :span="12">
                    <a-form-item label="å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹">
                      <a-slider
                        v-model:value="settings.imageScale"
                        :min="5"
                        :max="150"
                        :step="5"
                        :marks="{30: '30%', 50: '50%', 100: '100%'}"
                      />
                      <div>å½“å‰: {{ settings.imageScale }}%</div>
                    </a-form-item>
                  </a-col>
                  <a-col :span="12">
                    <a-form-item label="ç½‘æ ¼åˆ—æ•°">
                      <a-slider
                        v-model:value="settings.gridColumns"
                        :min="2"
                        :max="8"
                        :step="1"
                        :marks="{2: '2', 4: '4', 6: '6', 8: '8'}"
                      />
                    </a-form-item>
                  </a-col>
                </a-row>

                <a-form-item label="è¾“å‡ºæ ¼å¼">
                  <a-radio-group v-model:value="settings.outputFormat">
                    <a-radio value="markdown">Markdown</a-radio>
                    <a-radio value="html">HTML</a-radio>
                  </a-radio-group>
                </a-form-item>

                <a-form-item>
                  <a-checkbox v-model:checked="settings.showSearchBar">æ˜¾ç¤ºæœç´¢æ </a-checkbox>
                </a-form-item>

                <a-form-item>
                  <a-checkbox v-model:checked="settings.forceMobileMode">å¼ºåˆ¶ç§»åŠ¨ç«¯æ¨¡å¼</a-checkbox>
                </a-form-item>

                <a-form-item>
                  <a-button type="primary" @click="saveSettings">ä¿å­˜è®¾ç½®</a-button>
                </a-form-item>
              </a-form>
            </div>

            <!-- Favorites -->
            <div v-if="activeTab === 'favorites'" class="management-section">
              <h2>æ”¶è—å¤¹</h2>
              <div
                v-if="favorites.length === 0"
                style="text-align: center; color: #999; padding: 40px"
              >
                è¿˜æ²¡æœ‰æ”¶è—çš„è¡¨æƒ…
              </div>
              <div
                v-else
                class="emoji-grid"
                :style="{gridTemplateColumns: `repeat(${settings.gridColumns}, 1fr)`}"
              >
                <img
                  v-for="emoji in favorites"
                  :key="emoji.id"
                  :src="emoji.url"
                  :alt="emoji.name"
                  :title="emoji.name"
                  class="emoji-item"
                  @click="removeFromFavorites(emoji.id)"
                />
              </div>
            </div>

            <!-- Export/Sync -->
            <div v-if="activeTab === 'export'" class="management-section">
              <h2>æ•°æ®å¯¼å‡ºä¸åŒæ­¥</h2>

              <a-space direction="vertical" style="width: 100%">
                <div>
                  <h3>ç”¨æˆ·è„šæœ¬åŒæ­¥</h3>
                  <p>å°†å½“å‰æ•°æ®åŒæ­¥åˆ°ç”¨æˆ·è„šæœ¬çš„localStorageä¸­</p>
                  <a-button type="primary" @click="syncToUserscript">åŒæ­¥åˆ°ç”¨æˆ·è„šæœ¬</a-button>
                </div>

                <a-divider />

                <div>
                  <h3>æ•°æ®å¯¼å‡º</h3>
                  <p>å¯¼å‡ºå®Œæ•´çš„è¡¨æƒ…æ•°æ®ä»¥ä¾¿å¤‡ä»½æˆ–åˆ†äº«</p>
                  <a-space>
                    <a-button @click="exportData">å¯¼å‡º JSON</a-button>
                    <a-button @click="exportForUserscript">å¯¼å‡ºç”¨æˆ·è„šæœ¬æ•°æ®</a-button>
                  </a-space>
                </div>

                <a-divider />

                <div>
                  <h3>æ•°æ®å¯¼å…¥</h3>
                  <p>ä»å¤‡ä»½æ–‡ä»¶æˆ–å…¶ä»–æ¥æºå¯¼å…¥è¡¨æƒ…æ•°æ®</p>
                  <a-button @click="showImportModal = true">å¯¼å…¥æ•°æ®</a-button>
                </div>
              </a-space>
            </div>
          </a-layout-content>
        </a-layout>
      </a-layout>

      <!-- Create Group Modal -->
      <a-modal v-model:open="showCreateGroupModal" title="åˆ›å»ºåˆ†ç»„" @ok="createGroup">
        <a-form layout="vertical">
          <a-form-item label="åˆ†ç»„åç§°" required>
            <a-input v-model:value="newGroup.name" placeholder="è¾“å…¥åˆ†ç»„åç§°" />
          </a-form-item>
          <a-form-item label="åˆ†ç»„å›¾æ ‡">
            <a-input v-model:value="newGroup.icon" placeholder="è¾“å…¥å›¾æ ‡æˆ–emoji" />
          </a-form-item>
        </a-form>
      </a-modal>

      <!-- Edit Group Modal -->
      <a-modal v-model:open="showEditGroupModal" title="ç¼–è¾‘åˆ†ç»„" @ok="updateGroup">
        <a-form layout="vertical">
          <a-form-item label="åˆ†ç»„åç§°" required>
            <a-input v-model:value="editingGroup.name" placeholder="è¾“å…¥åˆ†ç»„åç§°" />
          </a-form-item>
          <a-form-item label="åˆ†ç»„å›¾æ ‡">
            <a-input v-model:value="editingGroup.icon" placeholder="è¾“å…¥å›¾æ ‡æˆ–emoji" />
          </a-form-item>
        </a-form>
      </a-modal>

      <!-- Add Emoji Modal -->
      <a-modal v-model:open="showAddEmojiModal" title="æ·»åŠ è¡¨æƒ…" @ok="addEmoji">
        <a-form layout="vertical">
          <a-form-item label="è¡¨æƒ…åç§°" required>
            <a-input v-model:value="newEmoji.name" placeholder="è¾“å…¥è¡¨æƒ…åç§°" />
          </a-form-item>
          <a-form-item label="å›¾ç‰‡URL" required>
            <a-input v-model:value="newEmoji.url" placeholder="è¾“å…¥å›¾ç‰‡é“¾æ¥" />
          </a-form-item>
          <a-form-item v-if="newEmoji.url">
            <img :src="newEmoji.url" style="max-width: 100px; max-height: 100px" />
          </a-form-item>
        </a-form>
      </a-modal>

      <!-- Import Modal -->
      <a-modal v-model:open="showImportModal" title="å¯¼å…¥æ•°æ®" @ok="importData">
        <a-form layout="vertical">
          <a-form-item label="æ•°æ®æ ¼å¼">
            <a-radio-group v-model:value="importFormat">
              <a-radio value="json">JSON æ ¼å¼</a-radio>
              <a-radio value="userscript">ç”¨æˆ·è„šæœ¬æ ¼å¼</a-radio>
            </a-radio-group>
          </a-form-item>
          <a-form-item label="æ•°æ®å†…å®¹">
            <a-textarea v-model:value="importData" :rows="10" placeholder="ç²˜è´´è¦å¯¼å…¥çš„æ•°æ®" />
          </a-form-item>
        </a-form>
      </a-modal>
    </div>
    <script type="module" src="/src/emoji-manager.ts"></script>
  </body>
</html>
