<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>动图转换器</title>
    <link rel="icon" type="image/png" href="/img/48.png" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 300;
      }

      .header p {
        margin: 10px 0 0;
        opacity: 0.9;
        font-size: 1.1em;
      }

      .tool-tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
      }

      .tool-tab {
        flex: 1;
        padding: 20px;
        text-align: center;
        border: none;
        background: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        color: #6c757d;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
      }

      .tool-tab:hover {
        background: #e9ecef;
        color: #495057;
      }

      .tool-tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
        background: white;
      }

      .tool-content {
        padding: 40px;
      }

      .tool-section {
        display: none;
      }

      .tool-section.active {
        display: block;
      }

      .upload-area {
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 30px;
      }

      .upload-area:hover,
      .upload-area.dragover {
        border-color: #667eea;
        background: #f8f9ff;
      }

      .upload-icon {
        font-size: 3em;
        margin-bottom: 15px;
        color: #6c757d;
      }

      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .setting-group {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
      }

      .setting-group label {
        display: block;
        font-weight: 500;
        margin-bottom: 8px;
        color: #495057;
      }

      .setting-group select,
      .setting-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 14px;
      }

      .btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
        margin: 10px 5px;
      }

      .btn:hover {
        background: #5a6fd8;
        transform: translateY(-1px);
      }

      .btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      /* Ant Design Progress Styling */
      .ant-progress {
        position: relative;
        display: inline-block;
        width: 100%;
      }

      .ant-progress-outer {
        width: 100%;
        display: inline-block;
        vertical-align: middle;
      }

      .ant-progress-inner {
        position: relative;
        display: inline-block;
        width: calc(100% - 55px);
        vertical-align: middle;
        background: #f5f5f5;
        border-radius: 100px;
        overflow: hidden;
        height: 8px;
      }

      .ant-progress-bg {
        position: relative;
        background-color: #1890ff;
        border-radius: 100px;
        transition: all 0.4s cubic-bezier(0.08, 0.82, 0.17, 1) 0s;
        height: 100%;
      }

      .ant-progress-text {
        display: inline-block;
        width: 2em;
        margin-left: 8px;
        color: rgba(0, 0, 0, 0.65);
        font-size: 1em;
        line-height: 1;
        white-space: nowrap;
        text-align: left;
        vertical-align: middle;
        word-break: normal;
      }

      .result-area {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        display: none;
      }

      .frame-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .frame-item {
        background: white;
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .frame-item img {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin-bottom: 8px;
      }

      .frame-item .frame-name {
        font-size: 12px;
        color: #6c757d;
        word-break: break-all;
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 12px 16px;
        border-radius: 6px;
        margin: 15px 0;
        border: 1px solid #f5c6cb;
        display: none;
      }

      .success-message {
        background: #d4edda;
        color: #155724;
        padding: 12px 16px;
        border-radius: 6px;
        margin: 15px 0;
        border: 1px solid #c3e6cb;
        display: none;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>🎞️ 动图转换器</h1>
        <p>转换、拆分、合并动画文件，支持 GIF、MP4、WebM → APNG/GIF</p>
      </div>

      <!-- Tool Selection Tabs -->
      <div class="tool-tabs">
        <button class="tool-tab active" data-tool="converter">📁 格式转换</button>
        <button class="tool-tab" data-tool="splitter">✂️ 帧拆分</button>
        <button class="tool-tab" data-tool="merger">🔗 帧合并</button>
      </div>

      <!-- Main Content -->
      <div class="tool-content">
        <!-- Format Converter -->
        <div id="converter" class="tool-section active">
          <h2>格式转换器</h2>
          <p>将 GIF、MP4、WebM 转换为 APNG 或 GIF 格式</p>

          <div class="upload-area" id="converter-upload">
            <div class="upload-icon">📂</div>
            <h3>拖拽文件到此处或点击选择</h3>
            <p>支持 GIF、MP4、WebM 格式，最大 100MB</p>
            <input type="file" id="converter-file" accept=".gif,.mp4,.webm" style="display: none" />
          </div>

          <div class="settings-grid">
            <div class="setting-group">
              <label for="output-format">输出格式</label>
              <select id="output-format">
                <option value="gif">GIF</option>
                <option value="apng">APNG</option>
              </select>
            </div>
            <div class="setting-group">
              <label for="quality">质量</label>
              <select id="quality">
                <option value="high">高质量</option>
                <option value="medium" selected>中等质量</option>
                <option value="low">低质量</option>
              </select>
            </div>
            <div class="setting-group">
              <label for="frame-rate">帧率 (FPS)</label>
              <input type="number" id="frame-rate" value="15" min="5" max="60" />
            </div>
            <div class="setting-group">
              <label for="max-width">最大宽度 (px)</label>
              <input type="number" id="max-width" value="480" min="100" max="1920" />
            </div>
          </div>

          <button class="btn" id="convert-btn" disabled>开始转换</button>
        </div>

        <!-- Frame Splitter -->
        <div id="splitter" class="tool-section">
          <h2>帧拆分器</h2>
          <p>从动画文件中提取单独的帧</p>

          <div class="upload-area" id="splitter-upload">
            <div class="upload-icon">📂</div>
            <h3>拖拽动画文件到此处</h3>
            <p>支持 GIF、MP4、WebM、APNG 格式</p>
            <input
              type="file"
              id="splitter-file"
              accept=".gif,.mp4,.webm,.png"
              style="display: none"
            />
          </div>

          <div class="settings-grid">
            <div class="setting-group">
              <label for="frame-format">帧格式</label>
              <select id="frame-format">
                <option value="png" selected>PNG</option>
                <option value="jpg">JPG</option>
                <option value="webp">WebP</option>
              </select>
            </div>
            <div class="setting-group">
              <label for="extract-every">提取间隔</label>
              <select id="extract-every">
                <option value="1" selected>每一帧</option>
                <option value="2">每2帧</option>
                <option value="3">每3帧</option>
                <option value="5">每5帧</option>
              </select>
            </div>
          </div>

          <button class="btn" id="split-btn" disabled>拆分帧</button>
        </div>

        <!-- Frame Merger -->
        <div id="merger" class="tool-section">
          <h2>帧合并器</h2>
          <p>将多张图片合并为动画</p>

          <div class="upload-area" id="merger-upload">
            <div class="upload-icon">🖼️</div>
            <h3>拖拽图片文件到此处</h3>
            <p>支持 PNG、JPG、WebP 格式，可选择多个文件</p>
            <input
              type="file"
              id="merger-files"
              accept=".png,.jpg,.jpeg,.webp"
              multiple
              style="display: none"
            />
          </div>

          <div class="settings-grid">
            <div class="setting-group">
              <label for="merge-format">输出格式</label>
              <select id="merge-format">
                <option value="gif" selected>GIF</option>
                <option value="apng">APNG</option>
              </select>
            </div>
            <div class="setting-group">
              <label for="merge-fps">帧率 (FPS)</label>
              <input type="number" id="merge-fps" value="10" min="1" max="30" />
            </div>
            <div class="setting-group">
              <label for="loop-count">循环次数</label>
              <select id="loop-count">
                <option value="0" selected>无限循环</option>
                <option value="1">1次</option>
                <option value="3">3次</option>
                <option value="5">5次</option>
              </select>
            </div>
          </div>

          <button class="btn" id="merge-btn" disabled>合并为动画</button>
        </div>

        <!-- Progress Bar -->
        <div id="progress-container" style="display: none; margin: 20px 0;">
          <div class="ant-progress ant-progress-line">
            <div class="ant-progress-outer">
              <div class="ant-progress-inner">
                <div 
                  class="ant-progress-bg" 
                  id="progress-fill"
                  style="width: 0%; height: 8px; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.3s ease;"
                ></div>
              </div>
            </div>
            <span class="ant-progress-text" id="progress-text" style="color: #333; font-weight: 500;">0%</span>
          </div>
          <div style="text-align: center; margin-top: 8px; font-size: 14px; color: #666;" id="progress-info">
            处理中...
          </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p id="loading-text">正在加载 FFmpeg...</p>
        </div>

        <!-- Messages -->
        <div class="error-message" id="error-message"></div>
        <div class="success-message" id="success-message"></div>

        <!-- Result Area -->
        <div class="result-area" id="result-area">
          <h3>处理结果</h3>
          <div id="result-content"></div>
        </div>
      </div>
    </div>

    <script type="module" src="/src/animation-converter.ts"></script>
  </body>
</html>
