/* Ant Design 组件样式覆盖 - must be before @tailwind */
@import './antdOverrides.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* ============ 滚动条 ============ */
    --scrollbar-track-color: #f9fafb;
    --scrollbar-thumb-color: #e5e7eb;
    --scrollbar-thumb-hover-color: #d1d5db;

    /* ============ 调色板 CSS 变量 ============ */
    /* 这些变量会在运行时由 md3Theme.ts 动态设置 */
    /* 格式：--palette-{name}-{tone} */
    /* 调色板：primary, secondary, tertiary, error, neutral, neutral-variant */
    /* 色阶：0, 4, 6, 10, 12, 17, 20, 22, 24, 30, 40, 50, 60, 70, 80, 87, 90, 92, 94, 95, 96, 98, 99, 100 */

    /* ============ MD3 语义颜色默认值 (Light) ============ */
    /* Primary */
    --md3-primary: #1976d2;
    --md3-on-primary: #ffffff;
    --md3-primary-container: #d1e4ff;
    --md3-on-primary-container: #001d36;

    /* Secondary */
    --md3-secondary: #535f70;
    --md3-on-secondary: #ffffff;
    --md3-secondary-container: #d7e3f8;
    --md3-on-secondary-container: #101c2b;

    /* Tertiary */
    --md3-tertiary: #6b5778;
    --md3-on-tertiary: #ffffff;
    --md3-tertiary-container: #f3daff;
    --md3-on-tertiary-container: #251431;

    /* Error */
    --md3-error: #ba1a1a;
    --md3-on-error: #ffffff;
    --md3-error-container: #ffdad6;
    --md3-on-error-container: #410002;

    /* Surface */
    --md3-background: #fdfcff;
    --md3-on-background: #1a1c1e;
    --md3-surface: #fdfcff;
    --md3-on-surface: #1a1c1e;
    --md3-surface-dim: #ddd9de;
    --md3-surface-bright: #fdfcff;
    --md3-surface-container-lowest: #ffffff;
    --md3-surface-container-low: #f7f2f7;
    --md3-surface-container: #f1ecf1;
    --md3-surface-container-high: #ebe6eb;
    --md3-surface-container-highest: #e5e1e6;
    --md3-surface-variant: #e0e2ec;
    --md3-on-surface-variant: #43474e;

    /* Outline */
    --md3-outline: #73777f;
    --md3-outline-variant: #c3c6cf;

    /* Inverse */
    --md3-inverse-surface: #2f3033;
    --md3-inverse-on-surface: #f1f0f4;
    --md3-inverse-primary: #a0cafd;

    /* Others */
    --md3-surface-tint: #1976d2;
    --md3-shadow: #000000;
    --md3-scrim: #000000;

    /* ============ 主题语义变量 (向后兼容) ============ */
    --theme-primary: var(--md3-primary);
    --theme-on-primary: var(--md3-on-primary);
    --theme-primary-container: var(--md3-primary-container);
    --theme-on-primary-container: var(--md3-on-primary-container);
    --theme-secondary: var(--md3-secondary);
    --theme-on-secondary: var(--md3-on-secondary);
    --theme-secondary-container: var(--md3-secondary-container);
    --theme-on-secondary-container: var(--md3-on-secondary-container);
    --theme-tertiary: var(--md3-tertiary);
    --theme-on-tertiary: var(--md3-on-tertiary);
    --theme-tertiary-container: var(--md3-tertiary-container);
    --theme-on-tertiary-container: var(--md3-on-tertiary-container);
    --theme-surface: var(--md3-surface);
    --theme-on-surface: var(--md3-on-surface);
    --theme-surface-dim: var(--md3-surface-dim);
    --theme-surface-bright: var(--md3-surface-bright);
    --theme-surface-container-lowest: var(--md3-surface-container-lowest);
    --theme-surface-container-low: var(--md3-surface-container-low);
    --theme-surface-container: var(--md3-surface-container);
    --theme-surface-container-high: var(--md3-surface-container-high);
    --theme-surface-container-highest: var(--md3-surface-container-highest);
    --theme-surface-variant: var(--md3-surface-variant);
    --theme-on-surface-variant: var(--md3-on-surface-variant);
    --theme-outline: var(--md3-outline);
    --theme-outline-variant: var(--md3-outline-variant);
    --theme-background: var(--md3-background);
    --theme-on-background: var(--md3-on-background);
    --theme-error: var(--md3-error);
    --theme-on-error: var(--md3-on-error);
    --theme-error-container: var(--md3-error-container);
    --theme-on-error-container: var(--md3-on-error-container);
    --theme-inverse-surface: var(--md3-inverse-surface);
    --theme-inverse-on-surface: var(--md3-inverse-on-surface);
    --theme-inverse-primary: var(--md3-inverse-primary);
    --theme-shadow: var(--md3-shadow);
    --theme-scrim: var(--md3-scrim);

    /* 兼容性别名 */
    --theme-accent: var(--md3-primary);
    --theme-accent-strong: var(--md3-primary-container);
    --theme-danger: var(--md3-error);
    --theme-on-danger: var(--md3-on-error);
  }

  .dark {
    --scrollbar-track-color: #1f2937;
    --scrollbar-thumb-color: #4b5563;
    --scrollbar-thumb-hover-color: #6b7280;
  }
}

/* 高对比度模式 */
@media (prefers-contrast: high) {
  :root {
    --hc-border-color: #000;
    --hc-bg-color: #fff;
    --hc-text-color: #000;
  }

  .dark {
    --hc-border-color: #fff;
    --hc-bg-color: #000;
    --hc-text-color: #fff;
  }

  .high-contrast {
    border: 2px solid var(--hc-border-color) !important;
    background: var(--hc-bg-color) !important;
    color: var(--hc-text-color) !important;
  }

  .high-contrast .emoji-item {
    border: 2px solid var(--hc-border-color) !important;
  }

  .high-contrast .group-tab-button {
    border-bottom: 3px solid transparent !important;
  }

  .high-contrast .group-tab-button[aria-selected='true'] {
    border-bottom: 3px solid var(--hc-border-color) !important;
  }
}

/* 减少动画 */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .no-motion {
    animation: none !important;
    transition: none !important;
  }
}

/* Custom utility classes for extension */
@layer components {
  /* Global dark-mode text and input defaults for options/popup */
  .options-root,
  .popup-container,
  body.dark .options-root,
  body.dark .popup-container {
    @apply dark:text-white;
  }

  /* Inputs, textareas and selects: in dark mode use dark background and white text */
  .dark input,
  .dark textarea,
  .dark select,
  .dark .ant-input {
    @apply bg-black text-white border-gray-600;
  }

  /* Ensure input placeholders are light in dark mode */
  .dark input::placeholder,
  .dark textarea::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }

  .emoji-picker-container {
    @apply fixed z-50 bg-white border border-gray-200 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-700;
  }

  .emoji-button {
    @apply flex items-center justify-center p-2 rounded hover:bg-gray-100 transition-colors cursor-pointer dark:hover:bg-gray-700;
  }

  .emoji-grid {
    @apply gap-2 p-4 dark:bg-gray-800;
    min-height: 300px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-color) var(--scrollbar-track-color);
  }

  .emoji-grid::-webkit-scrollbar {
    width: 6px;
  }

  .emoji-grid::-webkit-scrollbar-track {
    background: var(--scrollbar-track-color);
    border-radius: 3px;
  }

  .emoji-grid::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb-color);
    border-radius: 3px;
  }

  .emoji-grid::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover-color);
  }

  .scale-control {
    @apply flex items-center gap-2 p-2 bg-gray-50 rounded dark:bg-gray-700;
  }

  /* Limit Ant Design Vue dropdown overlay height to 30vh and enable scrolling */
  .ant-dropdown {
    /* Ensure the root dropdown wrapper doesn't constrain overlay positioning */
  }

  /* The actual overlay panel used by Ant Design Vue */
  .ant-dropdown .ant-dropdown-menu,
  .ant-dropdown .ant-dropdown-menu-root,
  .ant-dropdown .ant-dropdown-overlay,
  .ant-dropdown .ant-dropdown-content {
    max-height: 30vh !important;
    overflow: auto !important;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-color) var(--scrollbar-track-color);
  }

  .ant-dropdown .ant-dropdown-menu::-webkit-scrollbar,
  .ant-dropdown .ant-dropdown-overlay::-webkit-scrollbar,
  .ant-dropdown .ant-dropdown-content::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .ant-dropdown .ant-dropdown-menu::-webkit-scrollbar-track,
  .ant-dropdown .ant-dropdown-overlay::-webkit-scrollbar-track,
  .ant-dropdown .ant-dropdown-content::-webkit-scrollbar-track {
    background: var(--scrollbar-track-color);
    border-radius: 4px;
  }

  .ant-dropdown .ant-dropdown-menu::-webkit-scrollbar-thumb,
  .ant-dropdown .ant-dropdown-overlay::-webkit-scrollbar-thumb,
  .ant-dropdown .ant-dropdown-content::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb-color);
    border-radius: 4px;
  }

  .ant-dropdown .ant-dropdown-menu::-webkit-scrollbar-thumb:hover,
  .ant-dropdown .ant-dropdown-overlay::-webkit-scrollbar-thumb:hover,
  .ant-dropdown .ant-dropdown-content::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover-color);
  }

  /* 增强焦点指示器 */
  .focus-enhanced:focus {
    outline: 2px solid #0066cc !important;
    outline-offset: 2px !important;
  }

  .focus-enhanced:focus-visible {
    outline: 2px solid #0066cc !important;
    outline-offset: 2px !important;
  }

  .focus-enhanced:focus:not(:focus-visible) {
    outline: none !important;
  }

  /* ============ MD3 主题工具类 ============ */
  /* 使用 CSS 变量的便捷类 */

  /* 背景色 */
  .bg-md3-primary {
    background-color: var(--md3-primary);
  }
  .bg-md3-primary-container {
    background-color: var(--md3-primary-container);
  }
  .bg-md3-secondary {
    background-color: var(--md3-secondary);
  }
  .bg-md3-secondary-container {
    background-color: var(--md3-secondary-container);
  }
  .bg-md3-tertiary {
    background-color: var(--md3-tertiary);
  }
  .bg-md3-tertiary-container {
    background-color: var(--md3-tertiary-container);
  }
  .bg-md3-error {
    background-color: var(--md3-error);
  }
  .bg-md3-error-container {
    background-color: var(--md3-error-container);
  }
  .bg-md3-surface {
    background-color: var(--md3-surface);
  }
  .bg-md3-surface-dim {
    background-color: var(--md3-surface-dim);
  }
  .bg-md3-surface-bright {
    background-color: var(--md3-surface-bright);
  }
  .bg-md3-surface-container-lowest {
    background-color: var(--md3-surface-container-lowest);
  }
  .bg-md3-surface-container-low {
    background-color: var(--md3-surface-container-low);
  }
  .bg-md3-surface-container {
    background-color: var(--md3-surface-container);
  }
  .bg-md3-surface-container-high {
    background-color: var(--md3-surface-container-high);
  }
  .bg-md3-surface-container-highest {
    background-color: var(--md3-surface-container-highest);
  }
  .bg-md3-surface-variant {
    background-color: var(--md3-surface-variant);
  }
  .bg-md3-inverse-surface {
    background-color: var(--md3-inverse-surface);
  }

  /* 文字色 */
  .text-md3-primary {
    color: var(--md3-primary);
  }
  .text-md3-on-primary {
    color: var(--md3-on-primary);
  }
  .text-md3-on-primary-container {
    color: var(--md3-on-primary-container);
  }
  .text-md3-secondary {
    color: var(--md3-secondary);
  }
  .text-md3-on-secondary {
    color: var(--md3-on-secondary);
  }
  .text-md3-on-secondary-container {
    color: var(--md3-on-secondary-container);
  }
  .text-md3-tertiary {
    color: var(--md3-tertiary);
  }
  .text-md3-on-tertiary {
    color: var(--md3-on-tertiary);
  }
  .text-md3-on-tertiary-container {
    color: var(--md3-on-tertiary-container);
  }
  .text-md3-error {
    color: var(--md3-error);
  }
  .text-md3-on-error {
    color: var(--md3-on-error);
  }
  .text-md3-on-error-container {
    color: var(--md3-on-error-container);
  }
  .text-md3-on-surface {
    color: var(--md3-on-surface);
  }
  .text-md3-on-surface-variant {
    color: var(--md3-on-surface-variant);
  }
  .text-md3-on-background {
    color: var(--md3-on-background);
  }
  .text-md3-inverse-on-surface {
    color: var(--md3-inverse-on-surface);
  }
  .text-md3-inverse-primary {
    color: var(--md3-inverse-primary);
  }

  /* 边框色 */
  .border-md3-outline {
    border-color: var(--md3-outline);
  }
  .border-md3-outline-variant {
    border-color: var(--md3-outline-variant);
  }
  .border-md3-primary {
    border-color: var(--md3-primary);
  }
  .border-md3-secondary {
    border-color: var(--md3-secondary);
  }
  .border-md3-error {
    border-color: var(--md3-error);
  }

  /* 阴影 */
  .shadow-md3 {
    box-shadow: 0 1px 3px 1px var(--md3-shadow);
  }
}
