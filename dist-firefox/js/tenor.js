import{Bt as e,Ct as t,Ft as a,Gt as s,Kt as l,Rt as r,St as o,Yt as i,_t as d,bt as n,en as u,et as c,ft as v,gt as g,i as m,lt as y,ot as x,rn as p,rt as b,st as f,tn as h,wt as w,xt as k,yt as _}from"./main.js";import"./LoadingOutlined.js";import{T as A,a as P,l as I,n as K,t as T}from"./dropdown.js";import{o as j}from"./newStorage.js";var C={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},F={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6 dark:text-white"},S={key:0,class:"bg-white rounded-lg shadow-sm border p-6 mb-8 dark:bg-gray-800"},z={class:"space-y-4"},G=["disabled"],$={key:1,class:"space-y-6"},U={class:"bg-white rounded-lg shadow-sm border p-4 dark:bg-gray-800"},q={class:"flex justify-between items-center"},L={class:"text-xs text-gray-500 dark:text-white"},E={class:"bg-white rounded-lg shadow-sm border p-6 dark:bg-gray-800"},R={class:"flex gap-4"},V=["disabled"],D={class:"mt-4 flex gap-4 text-sm text-gray-700 dark:text-white"},H={class:"flex items-center gap-2 dark:text-white"},B={class:"flex items-center"},N={key:0,class:"bg-white rounded-lg shadow-sm border p-6"},O={class:"flex justify-between items-center mb-4"},Y={key:0,class:"flex gap-2"},J={class:"text-sm text-gray-600"},M={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"},Q=["onClick"],W=["src","alt"],X={key:0,class:"absolute top-2 right-2 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs"},Z={class:"mt-2"},ee=["title"],te={key:0,class:"mt-6 text-center"},ae=["disabled"],se={key:1,class:"bg-white rounded-lg shadow-sm border p-6 text-center"},le={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},re={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},oe={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6"},ie={class:"space-y-2 max-h-60 overflow-y-auto"},de=["value"],ne={class:"flex items-center gap-2"},ue={class:"text-lg"},ce={class:"font-medium"},ve={class:"text-sm text-gray-500"},ge={class:"mt-6 flex gap-3"},me=["disabled"],ye={class:"p-4"},xe={class:"flex"},pe={class:"flex-shrink-0"},be={class:"ml-3"},fe={class:"ml-auto pl-3"},he=b(w({__name:"Tenor",setup(c){const b=m(),w=i(""),he=i(""),we=i(""),ke=i([]),_e=i(new Set),Ae=i(!1),Pe=i(!1),Ie=i(!1),Ke=i(!1),Te=i(!1),je=i(""),Ce=i(12),Fe=i("high"),Se=i(!1),ze=i(""),Ge=i({text:"",type:"success"}),$e=g(()=>b.groups.filter(e=>"favorites"!==e.id));a(async()=>{await b.loadData();try{const t=await chrome.storage.local.get(["tenorApiKey"]);if(t.tenorApiKey)w.value=t.tenorApiKey;else try{const e=await j();e?.settings?.tenorApiKey&&(w.value=e.settings.tenorApiKey)}catch(e){}}catch(t){console.error("Failed to load Tenor API key:",t);try{const e=await j();e?.settings?.tenorApiKey&&(w.value=e.settings.tenorApiKey)}catch(e){}}});const Ue=async()=>{if(he.value.trim())try{await chrome.storage.local.set({tenorApiKey:he.value.trim()}),w.value=he.value.trim(),he.value="",De("API Key 已保存","success")}catch(e){console.error("Failed to save API key:",e),De("API Key 保存失败","error")}},qe=async()=>{try{await chrome.storage.local.remove(["tenorApiKey"]),w.value="",ke.value=[],_e.value.clear(),Ke.value=!1,De("API Key 已清除","success")}catch(e){console.error("Failed to clear API key:",e),De("API Key 清除失败","error")}},Le=async()=>{if(we.value.trim()&&w.value&&!Ae.value){Ae.value=!0,Ke.value=!0,ke.value=[],_e.value.clear(),je.value="";try{const e=new URL("https://tenor.googleapis.com/v2/search");e.searchParams.set("q",we.value.trim()),e.searchParams.set("key",w.value),e.searchParams.set("limit",Ce.value.toString()),e.searchParams.set("contentfilter",Fe.value),e.searchParams.set("media_filter","tinygif,gif");const t=await fetch(e.toString());if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const a=await t.json();a.results&&Array.isArray(a.results)?(ke.value=a.results,je.value=a.next||"",Te.value=!!a.next):(ke.value=[],Te.value=!1)}catch(e){console.error("Search failed:",e),De("搜索失败，请检查 API Key 或网络连接","error"),ke.value=[],Te.value=!1}finally{Ae.value=!1}}},Ee=async()=>{if(je.value&&!Pe.value){Pe.value=!0;try{const e=new URL("https://tenor.googleapis.com/v2/search");e.searchParams.set("q",we.value.trim()),e.searchParams.set("key",w.value),e.searchParams.set("limit",Ce.value.toString()),e.searchParams.set("contentfilter",Fe.value),e.searchParams.set("media_filter","tinygif,gif"),e.searchParams.set("pos",je.value);const t=await fetch(e.toString());if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const a=await t.json();a.results&&Array.isArray(a.results)&&(ke.value.push(...a.results),je.value=a.next||"",Te.value=!!a.next)}catch(e){console.error("Load more failed:",e),De("加载更多失败","error")}finally{Pe.value=!1}}},Re=()=>{0!==_e.value.size&&($e.value.length>0&&(ze.value=$e.value.find(e=>"ungrouped"===e.id)?"ungrouped":$e.value[0].id),Se.value=!0)},Ve=async()=>{if(ze.value&&0!==_e.value.size){Ie.value=!0;try{const t=ke.value.filter(e=>_e.value.has(e.id));let a=0;for(const s of t)try{const e={packet:Date.now(),name:s.content_description||`tenor-${s.id}`,url:s.media_formats.gif&&s.media_formats.gif.url||s.media_formats.tinygif&&s.media_formats.tinygif.url||""};b.addEmoji(ze.value,e),a++}catch(e){console.error("Failed to import GIF:",s.id,e)}a>0?(De(`成功导入 ${a} 个 GIF`,"success"),_e.value.clear(),Se.value=!1):De("导入失败","error")}catch(e){console.error("Import failed:",e),De("导入失败","error")}finally{Ie.value=!1}}},De=(e,t="success")=>{Ge.value={text:e,type:t},setTimeout(()=>{Ge.value.text=""},3e3)};return(a,i)=>{const c=P,g=K,m=I,b=T;return r(),n("div",C,[i[23]||(i[23]=k('<header class="bg-white shadow-sm border-b dark:bg-gray-800"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center py-6"><div><h1 class="text-2xl font-bold text-gray-900 dark:text-white">Tenor GIF 搜索</h1><p class="text-sm text-gray-600 dark:text-white">搜索并导入 Tenor GIF 表情到你的收藏</p></div></div></div></header>',1)),d("main",F,[w.value?(r(),n("div",$,[d("div",U,[d("div",q,[d("div",null,[i[11]||(i[11]=d("h3",{class:"text-sm font-medium text-gray-900 dark:text-white"},"API Key 已配置",-1)),d("p",L," Key: "+p(w.value.substring(0,8))+"... ",1)]),d("button",{onClick:qe,class:"px-3 py-1 text-sm text-red-600 hover:bg-red-50 rounded transition-colors"}," 重新配置 ")])]),d("div",E,[d("div",R,[l(d("input",{"onUpdate:modelValue":i[1]||(i[1]=e=>we.value=e),onKeyup:y(Le,["enter"]),type:"text",placeholder:"搜索 GIF...",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"},null,544),[[f,we.value]]),d("button",{onClick:Le,disabled:Ae.value||!we.value.trim(),class:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"},p(Ae.value?"搜索中...":"搜索"),9,V)]),d("div",D,[d("div",H,[t(b,null,{overlay:s(()=>[t(g,{onClick:i[2]||(i[2]=e=>(e=>{Ce.value=Number(String(e.key))})(e))},{default:s(()=>[t(c,{key:"12"},{default:s(()=>[...i[12]||(i[12]=[o("12 个结果",-1)])]),_:1}),t(c,{key:"24"},{default:s(()=>[...i[13]||(i[13]=[o("24 个结果",-1)])]),_:1}),t(c,{key:"48"},{default:s(()=>[...i[14]||(i[14]=[o("48 个结果",-1)])]),_:1})]),_:1})]),default:s(()=>[t(m,null,{default:s(()=>[o(p(Ce.value)+" 个结果 ",1),t(u(A))]),_:1})]),_:1})]),d("div",B,[t(b,null,{overlay:s(()=>[t(g,{onClick:i[3]||(i[3]=e=>(e=>{Fe.value=String(e.key)})(e))},{default:s(()=>[t(c,{key:"high"},{default:s(()=>[...i[15]||(i[15]=[o("高安全级别",-1)])]),_:1}),t(c,{key:"medium"},{default:s(()=>[...i[16]||(i[16]=[o("中等安全级别",-1)])]),_:1}),t(c,{key:"low"},{default:s(()=>[...i[17]||(i[17]=[o("低安全级别",-1)])]),_:1}),t(c,{key:"off"},{default:s(()=>[...i[18]||(i[18]=[o("关闭过滤",-1)])]),_:1})]),_:1})]),default:s(()=>[t(m,null,{default:s(()=>[o(p(Fe.value)+" ",1),t(u(A))]),_:1})]),_:1})])])]),ke.value.length>0?(r(),n("div",N,[d("div",O,[i[19]||(i[19]=d("h3",{class:"text-lg font-semibold text-gray-900"},"搜索结果",-1)),_e.value.size>0?(r(),n("div",Y,[d("span",J,"已选择 "+p(_e.value.size)+" 个",1),d("button",{onClick:Re,class:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 transition-colors"}," 导入选中 ")])):_("",!0)]),d("div",M,[(r(!0),n(v,null,e(ke.value,e=>(r(),n("div",{key:e.id,class:"relative group cursor-pointer",onClick:t=>(e=>{_e.value.has(e.id)?_e.value.delete(e.id):_e.value.add(e.id)})(e)},[d("div",{class:h(["aspect-square bg-gray-100 rounded-lg overflow-hidden",{"ring-2 ring-blue-500":_e.value.has(e.id),"ring-1 ring-gray-200":!_e.value.has(e.id)}])},[d("img",{src:e.media_formats?.tinygif?.url||e.media_formats?.gif?.url||"",alt:e.content_description,class:"w-full h-full object-cover",loading:"lazy"},null,8,W)],2),_e.value.has(e.id)?(r(),n("div",X," ✓ ")):_("",!0),d("div",Z,[d("p",{class:"text-xs text-gray-600 truncate",title:e.content_description},p(e.content_description||"Untitled"),9,ee)])],8,Q))),128))]),Te.value?(r(),n("div",te,[d("button",{onClick:Ee,disabled:Pe.value,class:"px-6 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors"},p(Pe.value?"加载中...":"加载更多"),9,ae)])):_("",!0)])):Ke.value&&!Ae.value?(r(),n("div",se,[...i[20]||(i[20]=[d("p",{class:"text-gray-500"},"未找到相关 GIF，请尝试其他关键词",-1)])])):_("",!0)])):(r(),n("div",S,[i[9]||(i[9]=d("h2",{class:"text-lg font-semibold text-gray-900 mb-4 dark:text-white"},"配置 Tenor API",-1)),i[10]||(i[10]=d("p",{class:"text-sm text-gray-600 mb-4 dark:text-white"},[o(" 请先设置你的 Tenor API Key。你可以在 "),d("a",{href:"https://developers.google.com/tenor/guides/quickstart",target:"_blank",class:"text-blue-600 hover:text-blue-800 underline"}," Tenor 开发者中心 "),o(" 申请免费的 API Key。 ")],-1)),d("div",z,[d("div",null,[i[8]||(i[8]=d("label",{for:"api-key",class:"block text-sm font-medium text-gray-700"}," Tenor API Key ",-1)),l(d("input",{id:"api-key","onUpdate:modelValue":i[0]||(i[0]=e=>he.value=e),type:"text",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"输入你的 Tenor API Key"},null,512),[[f,he.value]])]),d("button",{onClick:Ue,disabled:!he.value.trim(),class:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"}," 保存 API Key ",8,G)])]))]),Se.value?(r(),n("div",le,[d("div",re,[d("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:i[4]||(i[4]=e=>Se.value=!1)}),d("div",oe,[d("div",null,[i[21]||(i[21]=d("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"},"选择目标分组",-1)),d("div",ie,[(r(!0),n(v,null,e($e.value,e=>(r(),n("label",{key:e.id,class:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer"},[l(d("input",{type:"radio",value:e.id,"onUpdate:modelValue":i[5]||(i[5]=e=>ze.value=e),class:"mr-3"},null,8,de),[[x,ze.value]]),d("div",ne,[d("span",ue,p(e.icon),1),d("span",ce,p(e.name),1),d("span",ve," ("+p(e.emojis?.length||0)+" 个表情) ",1)])]))),128))]),d("div",ge,[d("button",{onClick:Ve,disabled:!ze.value||Ie.value,class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"},p(Ie.value?"导入中...":`导入 ${_e.value.size} 个 GIF`),9,me),d("button",{onClick:i[6]||(i[6]=e=>Se.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," 取消 ")])])])])])):_("",!0),Ge.value.text?(r(),n("div",{key:1,class:h(["fixed top-4 right-4 max-w-sm w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50",{"border-green-200 bg-green-50":"success"===Ge.value.type,"border-red-200 bg-red-50":"error"===Ge.value.type}])},[d("div",ye,[d("div",xe,[d("div",pe,[d("span",{class:h(["w-5 h-5 flex items-center justify-center rounded-full text-sm",{"bg-green-100 text-green-600":"success"===Ge.value.type,"bg-red-100 text-red-600":"error"===Ge.value.type}])},p("success"===Ge.value.type?"✓":"✕"),3)]),d("div",be,[d("p",{class:h(["text-sm font-medium",{"text-green-800":"success"===Ge.value.type,"text-red-800":"error"===Ge.value.type}])},p(Ge.value.text),3)]),d("div",fe,[d("button",{onClick:i[7]||(i[7]=e=>Ge.value.text=""),class:"inline-flex text-gray-400 hover:text-gray-600"},[...i[22]||(i[22]=[d("span",{class:"sr-only"},"关闭",-1),o(" ✕ ",-1)])])])])])],2)):_("",!0)])}}})),we=c();he.use(we),he.mount("#app");